{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="col s12 m12">
  {% if visible == False %}
  <div class="center-align">
    <h3>Contenu indisponnible</h3>
    <h4 class="card-title grey-text text-darken-4">Ce contenu est réservé aux abonnés</h4>
    <br><br>
    <a class="waves-effect waves-light btn-large"><i class="material-icons left">upgrade</i>S'abonner</a>
  </div>
  {% else %}
  <div class="card">
    <div class="card-image">
      <div class="slider">
        <ul class="slides">
          {% for con in post.content.all %}
          <li>
            {% if con.file.name|slice:"-3:" == 'jpg' or con.file.name|slice:"-4:" == 'jpeg' or con.file.name|slice:"-3:" == 'png' %}
            <img src="{{ con.file.url }}">
            {% else %}
            <div class="video-container">
              <video class="responsive-video" controls="controls" preload="metadata">
                <source src="{{ con.file.url }}#t=0.5" type="video/mp4">
              </video>
            </div>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </div>
      <a href="{% url 'postbookmark' post.id %}"
        class="btn-floating halfway-fab waves-effect waves-light red">Favoris</a>
    </div>
    <ul class="collection">
      <li class="collection-item avatar">
        {% if post.user.profile.picture %}
        <img src="{{ post.user.profile.picture.url }}" class="circle responsive-img">
        {% else %}
        <img src="{% static 'img/no_avatar.jpg' %}" class="circle responsive-img">
        {% endif %}
        <span style="font-size: 20px; font-weight: bold;" class="title">{{ post.user.first_name }}
          {{ post.user.last_name }}</span>
        <span class="title secondary-content">{{ post.posted }}</span>
        <p>@{{ post.user.username }}</p>
      </li>
      <div class="card-content">
        <h4 class="header">{{ post.title }}</h4>
        {{ post.caption }}
      </div>
      <div class="card-action">
        {% if liked == True %}
        <a class="red-text tooltipped" data-position="bottom" data-tooltip="Remove like"
          href="{% url 'postlike' post.id %}">{{ post.likes_count }} Likes</a>
        {% else %}
        <a href="{% url 'postlike' post.id %}">{{ post.likes_count }} Likes</a>
        {% endif %}
        <a href="#">{{ post.favorites_count }} Favoris</a>
        <a href="#">{{ post.comments_count }} Commentaires</a>
      </div>
      <div class="card-panel">
        <h5>Commentaires:</h5>
        <div class="divider"></div>
        <ul class="collection">
          {% for comment in comments %}
          <li class="collection-item avatar">
            {% if comment.user.profile.picture %}
            <img src="{{ comment.user.profile.picture.url }}" class="circle responsive-img">
            {% else %}
            <img src="{% static 'img/no_avatar.jpg' %}" class="circle responsive-img">
            {% endif %}
            <span style="font-weight: bold; font-size: 20px" class="title">{{ comment.user.first_name }}
              {{ comment.user.last_name }}</span>
            <span class="title secondary-content">{{ comment.date }}</span>
            <p>@{{ comment.user.username }}</p>
            <br>
            {{ comment.body }}
          </li>
          {% empty %}
          <div class="center-align">
            <span>Soyez le premier à commenter</span>
          </div>
          {% endfor %}
        </ul>
        <div class="row">
          <form method="POST" action="" role="form" class="col s12">
            {% csrf_token %}
            <div class="row">
              <div class="input-field col s12">{{ form.body }}
                <label for="body">Commentaire</label>
              </div>
              <button class="btn waves-effect waves-light" type="submit" name="action">Envoyer</button>
            </div>
          </form>
        </div>
      </div>
    </ul>
    {% endif %}
  </div>
</div>
  {% endblock %}